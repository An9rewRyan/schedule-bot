# Настройка Telegram Mini App

Этот документ описывает, как настроить и запустить Telegram Mini App для системы записи на тренировки.

## Структура проекта

```
schedule-bot-1/
├── backend/           # FastAPI бэкенд
├── frontend/          # Mini App интерфейс
├── tg_bot/           # Telegram бот
└── MINI_APP_SETUP.md # Этот файл
```

## Шаг 1: Настройка бэкенда

### 1.1 Установка зависимостей

```bash
cd backend
pip install -r requirements.txt
```

### 1.2 Настройка CORS

В файле `backend/src/main.py` уже добавлена поддержка CORS. Убедитесь, что в `allow_origins` указан ваш домен:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://web.telegram.org",  # Telegram Web App
        "https://your-domain.com",   # Замените на ваш домен
        "http://localhost:3000",     # Для разработки
        "http://localhost:8080",     # Для разработки
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 1.3 Запуск бэкенда

```bash
cd backend
uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
```

## Шаг 2: Настройка фронтенда

### 2.1 Размещение файлов

Разместите файлы из папки `frontend/` на веб-сервере:
- `index.html`
- `styles.css`
- `app.js`
- `config.js`

### 2.2 Настройка конфигурации

В файле `frontend/config.js` измените URL API на ваш:

```javascript
const config = {
    API_BASE_URL: 'https://your-domain.com/api', // Замените на ваш URL
    // ... остальные настройки
};
```

В файле `frontend/app.js` также измените URL:

```javascript
const API_BASE_URL = 'https://your-domain.com/api'; // Замените на ваш URL
```

## Шаг 3: Настройка бота

### 3.1 Обновление обработчиков

Замените файл `tg_bot/handlers/start.py` на `tg_bot/handlers/start_mini_app.py` или обновите существующий файл.

### 3.2 Настройка URL Mini App

В файле `tg_bot/handlers/start_mini_app.py` измените URL:

```python
MINI_APP_URL = "https://your-domain.com/frontend/index.html"  # Замените на ваш URL
```

### 3.3 Запуск бота

```bash
cd tg_bot
python main.py
```

## Шаг 4: Создание Mini App в BotFather

### 4.1 Создание бота (если еще не создан)

1. Откройте @BotFather в Telegram
2. Отправьте `/newbot`
3. Следуйте инструкциям для создания бота

### 4.2 Создание Mini App

1. Отправьте `/newapp` в @BotFather
2. Выберите вашего бота
3. Введите название Mini App (например, "Запись на тренировки")
4. Введите описание (например, "Система бронирования тренировок")
5. Загрузите иконку (512x512 пикселей)
6. Введите URL вашего Mini App: `https://your-domain.com/frontend/index.html`

### 4.3 Настройка команд

Отправьте `/setcommands` в @BotFather и выберите вашего бота. Затем отправьте:

```
start - Запустить бота
app - Открыть приложение
admin - Админ панель (только для админов)
```

## Шаг 5: Тестирование

### 5.1 Локальное тестирование

Для локального тестирования:

1. Запустите бэкенд на `localhost:8000`
2. Разместите фронтенд на `localhost:3000` (например, используя Live Server в VS Code)
3. Обновите CORS настройки в бэкенде
4. Обновите URL в конфигурации фронтенда

### 5.2 Продакшн тестирование

1. Разместите фронтенд на вашем домене
2. Обновите все URL в конфигурации
3. Протестируйте через Telegram

## Шаг 6: Деплой

### 6.1 Фронтенд

Разместите файлы фронтенда на статическом хостинге:
- GitHub Pages
- Netlify
- Vercel
- Ваш собственный сервер

### 6.2 Бэкенд

Разверните бэкенд на:
- Heroku
- DigitalOcean
- AWS
- Ваш собственный сервер

### 6.3 SSL сертификат

Убедитесь, что ваш домен имеет SSL сертификат (HTTPS), так как Telegram Mini App требует безопасное соединение.

## Возможные проблемы

### CORS ошибки

Если возникают CORS ошибки:
1. Проверьте настройки CORS в бэкенде
2. Убедитесь, что домен указан правильно
3. Проверьте, что фронтенд и бэкенд используют правильные протоколы (HTTP/HTTPS)

### Ошибки авторизации

Если пользователи не могут авторизоваться:
1. Проверьте, что пользователь зарегистрирован в системе
2. Убедитесь, что API endpoints работают корректно
3. Проверьте логи бэкенда

### Mini App не открывается

Если Mini App не открывается:
1. Проверьте URL в BotFather
2. Убедитесь, что сайт доступен по HTTPS
3. Проверьте, что все файлы загружаются корректно

## Дополнительные настройки

### Кастомизация темы

Измените цвета и стили в `frontend/styles.css`:

```css
:root {
    --tg-theme-bg-color: #ffffff;
    --tg-theme-text-color: #000000;
    --tg-theme-button-color: #2481cc;
    --tg-theme-button-text-color: #ffffff;
}
```

### Добавление новых функций

1. Добавьте новые API endpoints в бэкенд
2. Обновите фронтенд для работы с новыми endpoints
3. Добавьте соответствующие обработчики в бота

## Поддержка

При возникновении проблем:
1. Проверьте логи бэкенда и бота
2. Убедитесь, что все URL настроены правильно
3. Проверьте консоль браузера на наличие ошибок JavaScript
4. Убедитесь, что все зависимости установлены 